name: ðŸ“œ Generate Auto Changelog

on:
  push:
    branches:
      - main

jobs:
  changelog:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„

      - name: ðŸ“ Generate Changelog
        run: |
          # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ú©Ø§Ù…ÛŒØª Ù‚Ø¨Ù„ÛŒ (ÛŒØ§ Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ØŒ Ø­Ø§Ù„Øª Ø®Ø§Ù„ÛŒ)
          if git rev-parse HEAD~1 >/dev/null 2>&1; then
            PREV_COMMIT="HEAD~1"
          else
            PREV_COMMIT=$(git hash-object -t tree /dev/null)
          fi

          DIFF=$(git diff $PREV_COMMIT HEAD)

          echo "diff<<EOF" >> $GITHUB_ENV
          echo "$DIFF" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: ðŸ¤– Create GitHub Copilot changelog
        uses: github/copilot@latest
        with:
          prompt: |
            Generate a concise, human-readable changelog based on this diff:
            ${{ env.diff }}
        id: changelog

      - name: ðŸ’¾ Save changelog to file
        run: echo "${{ steps.changelog.outputs.text }}" > CHANGELOG.md

      - name: ðŸ“¤ Upload changelog artifact
        uses: actions/upload-artifact@v4
        with:
          name: changelog
          path: CHANGELOG.md
